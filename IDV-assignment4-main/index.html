
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adversarial Robustness Dashboard | IDV Assignment 4</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        /* --- 1. 全局布局与配色 --- */
        :root {
            --bg-color: #0b0e14;
            --sidebar-bg: rgba(23, 28, 38, 0.7);
            --accent-color: #6366f1; /* Indigo */
            --accent-hover: #818cf8;
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh; /* 全屏高度 */
            overflow: hidden; /* 防止整体滚动，内容内部滚动 */
            display: flex; /* Flexbox 布局 */
        }

        /* --- 2. 左侧边栏 (Sidebar) --- */
        aside {
            width: 320px;
            flex-shrink: 0;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            backdrop-filter: blur(20px); /* 毛玻璃 */
            display: flex;
            flex-direction: column;
            padding: 30px;
            box-sizing: border-box;
            overflow-y: auto;
            z-index: 10;
        }

        header { margin-bottom: 40px; }

        h1 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 10px 0;
            background: linear-gradient(135deg, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        p.desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.6;
            margin: 0;
        }

        /* 控制区 */
        .control-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6366f1;
            margin-bottom: 15px;
            font-weight: 700;
        }

        /* 按钮垂直排列 */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            padding: 12px 15px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        button:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent-color);
            padding-left: 20px; /* 悬停位移效果 */
        }

        button.active-btn {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        /* 滑动条容器 */
        .slider-container {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        input[type=range] {
            width: 100%;
            background: transparent;
            -webkit-appearance: none;
        }

        input[type=range]::-webkit-slider-runnable-track {
            background: #334155;
            height: 4px;
            border-radius: 2px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: var(--accent-color);
            border-radius: 50%;
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }

        /* --- 3. 右侧内容区 (Main Content) --- */
        main {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at top right, #1e293b 0%, #0b0e14 60%);
            overflow: auto; /* 允许图表滚动如果屏幕太小 */
            padding: 20px;
        }

        #chart-container {
            /* 增加微妙的浮动感 */
            filter: drop-shadow(0 20px 50px rgba(0,0,0,0.5));
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            padding: 12px 16px;
            font-size: 13px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            border-radius: 6px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.1s;
            z-index: 100;
            backdrop-filter: blur(4px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            line-height: 1.4;
        }

        /* D3 Elements Styling */
        .axis text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            fill: #64748b;
        }

        .axis text.active {
            fill: var(--accent-hover);
            font-weight: 700;
            font-size: 12px;
        }
        
        .axis path, .axis line { display: none; }

        .legend-text { fill: #64748b; font-size: 11px; font-family: 'Inter', sans-serif; }
        .main-label { fill: #e2e8f0; font-size: 14px; font-weight: 600; font-family: 'Inter', sans-serif; letter-spacing: 1px; }

    </style>
</head>
<body>

    <!-- 左侧功能面板 -->
    <aside>
        <header>
            <h1>Robustness<br>Matrix</h1>
            <p class="desc">Visualizing the resilience of 9 defense models against 26 adversarial attack types.</p>
        </header>

        <div class="control-section">
            <div class="section-title">Sorting Strategy</div>
            <div class="btn-group">
                <button id="btn-orig" class="active-btn">
                    <span>Original Index</span>
                    <span>●</span>
                </button>
                <button id="btn-best-model">
                    <span>Best Performance</span>
                    <span>→</span>
                </button>
                <button id="btn-hard-attack">
                    <span>Hardest Attacks</span>
                    <span>↓</span>
                </button>
            </div>
        </div>

        <div class="control-section">
            <div class="section-title">Filter Threshold</div>
            <div class="slider-container">
                <div class="slider-header">
                    <span>Min Score</span>
                    <span id="slider-val" style="color: var(--accent-color); font-weight:bold;">0</span>
                </div>
                <input type="range" id="filterSlider" min="0" max="100" value="0" step="1">
            </div>
            <p style="margin-top:10px; font-size: 0.75rem; color: #64748b;">
                Drag to focus on high-performing model/attack pairs.
            </p>
        </div>

        <div style="margin-top: auto; font-size: 0.7rem; color: #475569;">
            IDV Assignment 4 • Data Option 2<br>
            D3.js Interactive Visualization
        </div>
    </aside>

    <!-- 右侧主图表区 -->
    <main>
        <div id="chart-container"></div>
        <div id="tooltip" class="tooltip"></div>
    </main>

    <script>
        // --- 1. Data Logic ---
        const rawData = [
            {Attack: "No Attack", ERM: 94.85, DA: 94.21, PGDT: 84.38, TRADES: 80.42, MART: 81.54, RS: 89.45, IBP: 48.40, PRL: 93.82, TandT: 94.23},
            {Attack: "TIFGSM", ERM: 35.10, DA: 33.00, PGDT: 65.70, TRADES: 62.90, MART: 69.10, RS: 45.40, IBP: 40.20, PRL: 34.00, TandT: 92.80},
            {Attack: "MIFGSM", ERM: 0.00, DA: 0.00, PGDT: 50.90, TRADES: 51.90, MART: 50.50, RS: 5.80, IBP: 38.10, PRL: 0.00, TandT: 92.80},
            {Attack: "DIFGSM", ERM: 1.00, DA: 0.00, PGDT: 51.75, TRADES: 50.50, MART: 53.60, RS: 4.10, IBP: 38.10, PRL: 3.10, TandT: 92.80},
            {Attack: "VMIFGSM", ERM: 0.00, DA: 0.00, PGDT: 51.10, TRADES: 50.90, MART: 51.90, RS: 4.10, IBP: 38.10, PRL: 0.00, TandT: 93.90},
            {Attack: "TPGD", ERM: 38.10, DA: 39.20, PGDT: 69.30, TRADES: 69.10, MART: 70.10, RS: 48.50, IBP: 50.00, PRL: 28.90, TandT: 91.80},
            {Attack: "FGSM", ERM: 29.90, DA: 25.80, PGDT: 57.95, TRADES: 54.60, MART: 61.90, RS: 28.90, IBP: 38.10, PRL: 25.80, TandT: 93.80},
            {Attack: "RFGSM", ERM: 0.00, DA: 0.00, PGDT: 49.15, TRADES: 50.40, MART: 48.50, RS: 3.70, IBP: 38.10, PRL: 0.00, TandT: 90.00},
            {Attack: "BIM", ERM: 0.00, DA: 0.00, PGDT: 52.00, TRADES: 57.20, MART: 47.40, RS: 2.10, IBP: 38.10, PRL: 0.00, TandT: 90.70},
            {Attack: "FAB", ERM: 1.00, DA: 2.10, PGDT: 43.00, TRADES: 46.40, MART: 40.20, RS: 5.30, IBP: 38.10, PRL: 4.10, TandT: 90.10},
            {Attack: "CW", ERM: 0.00, DA: 0.00, PGDT: 32.20, TRADES: 35.10, MART: 29.90, RS: 1.00, IBP: 40.20, PRL: 1.00, TandT: 92.90},
            {Attack: "UPGD", ERM: 0.00, DA: 0.00, PGDT: 49.85, TRADES: 50.50, MART: 49.80, RS: 5.10, IBP: 38.10, PRL: 0.00, TandT: 93.80},
            {Attack: "FFGSM", ERM: 19.60, DA: 23.70, PGDT: 60.55, TRADES: 55.70, MART: 66.00, RS: 33.00, IBP: 42.30, PRL: 29.90, TandT: 92.80},
            {Attack: "Jitter", ERM: 11.30, DA: 12.40, PGDT: 48.15, TRADES: 47.40, MART: 49.50, RS: 34.00, IBP: 39.20, PRL: 24.70, TandT: 90.70},
            {Attack: "PGD", ERM: 0.00, DA: 0.00, PGDT: 57.40, TRADES: 54.60, MART: 60.80, RS: 7.20, IBP: 40.20, PRL: 0.00, TandT: 91.80},
            {Attack: "EOTPGD", ERM: 0.00, DA: 0.00, PGDT: 50.10, TRADES: 50.30, MART: 50.50, RS: 3.00, IBP: 38.10, PRL: 0.00, TandT: 90.70},
            {Attack: "APGD", ERM: 0.00, DA: 0.00, PGDT: 48.40, TRADES: 51.00, MART: 46.40, RS: 1.00, IBP: 38.10, PRL: 0.00, TandT: 90.70},
            {Attack: "NIFGSM", ERM: 0.00, DA: 0.00, PGDT: 57.95, TRADES: 56.70, MART: 59.80, RS: 7.20, IBP: 38.10, PRL: 1.00, TandT: 92.80},
            {Attack: "SiniFGSM", ERM: 4.10, DA: 1.00, PGDT: 59.00, TRADES: 56.70, MART: 61.90, RS: 23.70, IBP: 38.10, PRL: 12.40, TandT: 93.70},
            {Attack: "VNIFGSM", ERM: 0.00, DA: 0.00, PGDT: 50.45, TRADES: 53.00, MART: 48.50, RS: 5.10, IBP: 38.10, PRL: 0.00, TandT: 92.90},
            {Attack: "APGDT", ERM: 0.00, DA: 0.00, PGDT: 40.90, TRADES: 44.30, MART: 38.10, RS: 0.00, IBP: 38.10, PRL: 0.00, TandT: 88.70},
            {Attack: "Square", ERM: 0.00, DA: 1.00, PGDT: 50.40, TRADES: 54.00, MART: 47.40, RS: 3.10, IBP: 38.10, PRL: 2.10, TandT: 88.08},
            {Attack: "Add G. Noise", ERM: 25.80, DA: 43.30, PGDT: 79.10, TRADES: 78.40, MART: 80.40, RS: 74.20, IBP: 42.30, PRL: 45.40, TandT: 87.60},
            {Attack: "OnePixel", ERM: 79.40, DA: 83.50, PGDT: 78.05, TRADES: 74.20, MART: 82.50, RS: 83.50, IBP: 42.50, PRL: 80.40, TandT: 89.70},
            {Attack: "Pixle", ERM: 0.00, DA: 0.00, PGDT: 12.55, TRADES: 11.30, MART: 14.40, RS: 1.00, IBP: 10.30, PRL: 0.00, TandT: 17.50},
            {Attack: "PGDL2", ERM: 1.00, DA: 0.00, PGDT: 35.80, TRADES: 36.10, MART: 36.10, RS: 5.20, IBP: 36.10, PRL: 0.00, TandT: 92.90}
        ];

        const approaches = ["ERM", "DA", "PGDT", "TRADES", "MART", "RS", "IBP", "PRL", "TandT"];
        const attacksOriginal = rawData.map(d => d.Attack);
        
        const modelStats = approaches.map(m => ({ name: m, avg: d3.mean(rawData, d => d[m]) }));
        const attackStats = rawData.map(d => {
            const vals = approaches.map(a => d[a]);
            return { name: d.Attack, avg: d3.mean(vals) };
        });

        let longData = [];
        rawData.forEach(row => {
            approaches.forEach(approach => {
                longData.push({ attack: row.Attack, approach: approach, value: row[approach] });
            });
        });

        // --- 2. D3 Chart Setup ---
        const margin = { top: 50, right: 60, bottom: 100, left: 120 };
        const width = 900 - margin.left - margin.right;
        const height = 750 - margin.top - margin.bottom;

        const svg = d3.select("#chart-container")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const x = d3.scaleBand().range([0, width]).domain(approaches).padding(0.08);
        const y = d3.scaleBand().range([0, height]).domain(attacksOriginal).padding(0.08);
        const myColor = d3.scaleSequential().interpolator(d3.interpolateRdYlGn).domain([0, 100]);

        // Axes
        const xAxisGroup = svg.append("g").attr("class", "x-axis").attr("transform", `translate(0, ${height})`);
        const yAxisGroup = svg.append("g").attr("class", "y-axis");

        function renderAxes(transition) {
            let xG = transition ? xAxisGroup.transition(transition) : xAxisGroup;
            let yG = transition ? yAxisGroup.transition(transition) : yAxisGroup;

            xG.call(d3.axisBottom(x)).selectAll("text")
              .attr("class", "x-label")
              .style("text-anchor", "end")
              .attr("dx", "-.8em").attr("dy", ".15em").attr("transform", "rotate(-45)");

            yG.call(d3.axisLeft(y)).selectAll("text").attr("class", "y-label");
        }
        renderAxes();

        // Main Labels
        svg.append("text").attr("x", width/2).attr("y", height + 70).attr("text-anchor", "middle").attr("class", "main-label").text("MODELS (DEFENSE)");
        svg.append("text").attr("transform", "rotate(-90)").attr("y", -90).attr("x", -height/2).attr("text-anchor", "middle").attr("class", "main-label").text("ATTACK METHODS");

        // --- 3. Heatmap Rendering ---
        const rectGroup = svg.append("g");
        const rects = rectGroup.selectAll("rect")
            .data(longData, d => d.approach + "-" + d.attack)
            .enter().append("rect")
            .attr("x", d => x(d.approach))
            .attr("y", d => y(d.attack))
            .attr("rx", 2).attr("ry", 2)
            .attr("width", x.bandwidth())
            .attr("height", y.bandwidth())
            .style("fill", d => myColor(d.value))
            .style("opacity", 0);

        // Intro Animation
        rects.transition().duration(800).delay((d, i) => i * 1).style("opacity", 1);

        // --- 4. Interactions ---
        const tooltip = d3.select("#tooltip");

        rects.on("mouseover", function(event, d) {
            if (d3.select(this).style("opacity") < 0.5) return;
            
            d3.select(this).style("stroke", "#fff").style("stroke-width", 2);
            
            tooltip.style("opacity", 1)
                .html(`<div style="color:#94a3b8; margin-bottom:2px; font-size:11px;">${d.attack}</div>
                       <div style="font-weight:bold; font-size:14px; margin-bottom:4px;">${d.approach}</div>
                       <div>Score: <span style="color:${d3.interpolateRdYlGn(d.value/100)}; font-weight:bold;">${d.value.toFixed(1)}</span></div>`)
                .style("left", (event.pageX + 20) + "px")
                .style("top", (event.pageY - 20) + "px");

            svg.selectAll(".x-label").filter(t => t === d.approach).classed("active", true);
            svg.selectAll(".y-label").filter(t => t === d.attack).classed("active", true);
        })
        .on("mousemove", (event) => tooltip.style("left", (event.pageX + 20) + "px").style("top", (event.pageY - 20) + "px"))
        .on("mouseleave", function() {
            d3.select(this).style("stroke", "none");
            tooltip.style("opacity", 0);
            svg.selectAll(".x-label, .y-label").classed("active", false);
        });

        // Sorting Logic
        function runSort() {
            const t = svg.transition().duration(800).ease(d3.easeCubicOut);
            rects.transition(t).attr("x", d => x(d.approach)).attr("y", d => y(d.attack));
            renderAxes(t);
        }

        function updateActiveButton(id) {
            d3.selectAll(".btn-group button").classed("active-btn", false);
            d3.select("#" + id).classed("active-btn", true);
        }

        d3.select("#btn-orig").on("click", () => {
            updateActiveButton("btn-orig");
            x.domain(approaches);
            y.domain(attacksOriginal);
            runSort();
        });

        d3.select("#btn-best-model").on("click", () => {
            updateActiveButton("btn-best-model");
            const sortedModels = [...modelStats].sort((a,b) => b.avg - a.avg).map(d => d.name);
            x.domain(sortedModels);
            runSort();
        });

        d3.select("#btn-hard-attack").on("click", () => {
            updateActiveButton("btn-hard-attack");
            const sortedAttacks = [...attackStats].sort((a,b) => a.avg - b.avg).map(d => d.name);
            y.domain(sortedAttacks);
            runSort();
        });

        d3.select("#filterSlider").on("input", function() {
            const val = +this.value;
            d3.select("#slider-val").text(val);
            rects.transition().duration(200)
                .style("opacity", d => d.value < val ? 0.05 : 1)
                .style("filter", d => d.value < val ? "grayscale(100%)" : "none");
        });

        // Legend
        const legendHeight = 200;
        const legendWidth = 8;
        const defs = svg.append("defs");
        const lg = defs.append("linearGradient").attr("id", "grad1").attr("x1", "0%").attr("y1", "100%").attr("x2", "0%").attr("y2", "0%");
        lg.append("stop").attr("offset", "0%").attr("stop-color", myColor(0));
        lg.append("stop").attr("offset", "50%").attr("stop-color", myColor(50));
        lg.append("stop").attr("offset", "100%").attr("stop-color", myColor(100));

        const legend = svg.append("g").attr("transform", `translate(${width + 20}, ${height/2 - legendHeight/2})`);
        legend.append("rect").attr("width", legendWidth).attr("height", legendHeight).style("fill", "url(#grad1)").attr("rx", 4);
        
        const yLegend = d3.scaleLinear().range([legendHeight, 0]).domain([0, 100]);
        const lag = legend.append("g").attr("transform", `translate(${legendWidth + 5}, 0)`).call(d3.axisRight(yLegend).ticks(5));
        lag.selectAll("text").attr("class", "legend-text");
        lag.selectAll("line").remove();
        lag.selectAll("path").remove();
        legend.append("text").attr("x", 0).attr("y", -10).text("Score").attr("class", "legend-text").style("font-weight", "bold");

    </script>
</body>
</html>
```
